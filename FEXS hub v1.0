-- M.HUB FOR YVH

local player = game.Players.LocalPlayer
local gui = Instance.new("ScreenGui")
gui.Name = "mHUB_YouVsHomer"
gui.Parent = player:WaitForChild("PlayerGui")
gui.ResetOnSpawn = false

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 200)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = gui

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
titleBar.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 1, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "m.HUB [You Vs Homer]"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 18
titleLabel.Parent = titleBar

-- Tab Buttons
local tabsFrame = Instance.new("Frame")
tabsFrame.Name = "TabsFrame"
tabsFrame.Size = UDim2.new(1, 0, 0, 30)
tabsFrame.Position = UDim2.new(0, 0, 0, 30)
tabsFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
tabsFrame.Parent = mainFrame

local mainTabButton = Instance.new("TextButton")
mainTabButton.Size = UDim2.new(0.5, 0, 1, 0)
mainTabButton.Text = "Main"
mainTabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
mainTabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
mainTabButton.Parent = tabsFrame

local settingsTabButton = Instance.new("TextButton")
settingsTabButton.Size = UDim2.new(0.5, 0, 1, 0)
settingsTabButton.Position = UDim2.new(0.5, 0, 0, 0)
settingsTabButton.Text = "Settings"
settingsTabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
settingsTabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
settingsTabButton.Parent = tabsFrame

-- Content Frames
local mainContent = Instance.new("Frame")
mainContent.Name = "MainContent"
mainContent.Size = UDim2.new(1, 0, 1, -60)
mainContent.Position = UDim2.new(0, 0, 0, 60)
mainContent.BackgroundTransparency = 1
mainContent.Visible = true
mainContent.Parent = mainFrame

local settingsContent = Instance.new("Frame")
settingsContent.Name = "SettingsContent"
settingsContent.Size = UDim2.new(1, 0, 1, -60)
settingsContent.Position = UDim2.new(0, 0, 0, 60)
settingsContent.BackgroundTransparency = 1
settingsContent.Visible = false
settingsContent.Parent = mainFrame

-- Tab Switching
mainTabButton.MouseButton1Click:Connect(function()
    mainContent.Visible = true
    settingsContent.Visible = false
    mainTabButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    settingsTabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
end)

settingsTabButton.MouseButton1Click:Connect(function()
    mainContent.Visible = false
    settingsContent.Visible = true
    mainTabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    settingsTabButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
end)

-- Settings Content
local lockMovementToggle = Instance.new("TextButton")
lockMovementToggle.Size = UDim2.new(1, 0, 0, 30)
lockMovementToggle.Text = "Lock Movement: Off"
lockMovementToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
lockMovementToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
lockMovementToggle.Parent = settingsContent

local isLocked = false
lockMovementToggle.MouseButton1Click:Connect(function()
    isLocked = not isLocked
    mainFrame.Draggable = not isLocked
    lockMovementToggle.Text = "Lock Movement: " .. (isLocked and "On" or "Off")
end)

-- Account Info
local accountInfo = Instance.new("TextLabel")
accountInfo.Size = UDim2.new(1, 0, 0, 90)
accountInfo.Position = UDim2.new(0, 0, 0, 30)
accountInfo.BackgroundTransparency = 1
accountInfo.TextColor3 = Color3.fromRGB(255, 255, 255)
accountInfo.Text = "Username: " .. player.Name .. "\nDisplay Name: " .. player.DisplayName .. "\nAccount Age: " .. player.AccountAge .. " days"
accountInfo.TextWrapped = true
accountInfo.Parent = settingsContent

-- Color Change (Simple example: Change text color)
local colorChangeLabel = Instance.new("TextLabel")
colorChangeLabel.Size = UDim2.new(1, 0, 0, 30)
colorChangeLabel.Position = UDim2.new(0, 0, 0, 120)
colorChangeLabel.BackgroundTransparency = 1
colorChangeLabel.Text = "Change GUI Text Color:"
colorChangeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
colorChangeLabel.Parent = settingsContent

local colorInput = Instance.new("TextBox")
colorInput.Size = UDim2.new(1, 0, 0, 30)
colorInput.Position = UDim2.new(0, 0, 0, 150)
colorInput.Text = "255,255,255"  -- RGB
colorInput.Parent = settingsContent

colorInput.FocusLost:Connect(function()
    local r, g, b = colorInput.Text:match("(%d+),(%d+),(%d+)")
    if r and g and b then
        local newColor = Color3.fromRGB(tonumber(r), tonumber(g), tonumber(b))
        -- Apply to all text elements (example)
        titleLabel.TextColor3 = newColor
        mainTabButton.TextColor3 = newColor
        settingsTabButton.TextColor3 = newColor
        lockMovementToggle.TextColor3 = newColor
        accountInfo.TextColor3 = newColor
        colorChangeLabel.TextColor3 = newColor
        -- Add more as needed
    end
end)

-- Main Content: ESP Toggle
local espToggle = Instance.new("TextButton")
espToggle.Size = UDim2.new(1, 0, 0, 30)
espToggle.Text = "ESP [Homer and Bart's]: Off"
espToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
espToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
espToggle.Parent = mainContent

local espEnabled = false
local espConnections = {}
local espHighlights = {}
local espBillboards = {}

local function updateESP()
    -- Clear existing ESP
    for _, highlight in pairs(espHighlights) do
        highlight:Destroy()
    end
    for _, billboard in pairs(espBillboards) do
        billboard:Destroy()
    end
    espHighlights = {}
    espBillboards = {}
    
    if not espEnabled then return end
    
    for _, plr in pairs(game.Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local team = plr.Team and plr.Team.Name or ""  -- Assume Team.Name is "Bart", "Homer", or role
            local role = plr:FindFirstChild("Role") and plr.Role.Value or team  -- If there's a Role StringValue, use that
            local color = Color3.fromRGB(255, 0, 0)  -- Default red
            local text = "HOMER"
            
            if role == "Bart" then
                color = Color3.fromRGB(0, 255, 0)
                text = "BART"
            elseif role == "Homer" then
                color = Color3.fromRGB(255, 0, 0)
                text = "HOMER"
            elseif role == "Dead" then
                text = "DEAD"
                color = Color3.fromRGB(128, 128, 128)  -- Gray for dead
            end
            
            -- Highlight
            local highlight = Instance.new("Highlight")
            highlight.OutlineColor = color
            highlight.FillTransparency = 1  -- No fill, just outline
            highlight.Parent = plr.Character
            table.insert(espHighlights, highlight)
            
            -- Billboard Text
            local billboard = Instance.new("BillboardGui")
            billboard.Size = UDim2.new(0, 100, 0, 50)
            billboard.AlwaysOnTop = true
            billboard.Adornee = plr.Character.Head
            local textLabel = Instance.new("TextLabel")
            textLabel.Size = UDim2.new(1, 0, 1, 0)
            textLabel.BackgroundTransparency = 1
            textLabel.Text = text
            textLabel.TextColor3 = color
            textLabel.Font = Enum.Font.SourceSansBold
            textLabel.TextSize = 14
            textLabel.Parent = billboard
            billboard.Parent = plr.Character.Head
            table.insert(espBillboards, billboard)
        end
    end
end

espToggle.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espToggle.Text = "ESP [Homer and Bart's]: " .. (espEnabled and "On" or "Off")
    if espEnabled then
        updateESP()  -- Initial update
        local connection = game:GetService("RunService").Heartbeat:Connect(function()
            -- Refresh every second (approx, using Heartbeat for efficiency, but throttle)
            wait(1)  -- Simple wait for 1 second
            updateESP()
        end)
        table.insert(espConnections, connection)
    else
        updateESP()  -- Clears ESP
        for _, conn in pairs(espConnections) do
            conn:Disconnect()
        end
        espConnections = {}
    end
end)

-- Handle team changes (Players added/removed, but since refresh every sec, it handles leaves/joins/changes)
game.Players.PlayerAdded:Connect(updateESP)
game.Players.PlayerRemoving:Connect(updateESP)
