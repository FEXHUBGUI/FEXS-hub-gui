--// THIS SCRIPT IS COPY RIGHTED BY M.HUB DO NOT STEAL OR SELL WITHOUT PERMISSON MM2 m.HUB
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Stats = game:GetService("Stats")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

--// SETTINGS DATA
local Settings = {
	Color = Color3.fromRGB(30, 30, 30),
	Accent = Color3.fromRGB(255, 60, 60),
	Scale = 1,
	ESP = false
}

--// GUI
local gui = Instance.new("ScreenGui")
gui.Name = "M.HUB[MM2]"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

--// TOGGLE BUTTON
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.fromScale(0.08, 0.06)
toggleBtn.Position = UDim2.fromScale(0.02, 0.5)
toggleBtn.Text = "M.HUB"
toggleBtn.BackgroundColor3 = Settings.Accent
toggleBtn.TextColor3 = Color3.new(1,1,1)
toggleBtn.Parent = gui
toggleBtn.BorderSizePixel = 0
toggleBtn.TextScaled = true

--// MAIN FRAME
local main = Instance.new("Frame")
main.Size = UDim2.fromScale(0.35, 0.45)
main.Position = UDim2.fromScale(0.5, 0.5)
main.AnchorPoint = Vector2.new(0.5,0.5)
main.BackgroundColor3 = Settings.Color
main.Visible = true
main.Parent = gui
main.BorderSizePixel = 0

Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)
local scale = Instance.new("UIScale", main)
scale.Scale = Settings.Scale

--// DRAG
local dragging, dragStart, startPos
main.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = main.Position
	end
end)
UserInputService.InputEnded:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
		dragging = false
	end
end)
UserInputService.InputChanged:Connect(function(i)
	if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then
		local delta = i.Position - dragStart
		main.Position = startPos + UDim2.fromOffset(delta.X, delta.Y)
	end
end)

--// TITLE
local title = Instance.new("TextLabel", main)
title.Size = UDim2.fromScale(1, 0.12)
title.Text = "M.HUB [MM2]"
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundTransparency = 1
title.TextScaled = true

--// PLAYER INFO
local info = Instance.new("TextLabel", main)
info.Position = UDim2.fromScale(0.05, 0.15)
info.Size = UDim2.fromScale(0.9, 0.15)
info.BackgroundTransparency = 1
info.TextColor3 = Color3.new(1,1,1)
info.TextScaled = true
info.Text = player.Name.." (@ "..player.DisplayName..")\nAccount Age: "..player.AccountAge.." days"

--// PROFILE PIC
local thumb = Instance.new("ImageLabel", main)
thumb.Position = UDim2.fromScale(0.05, 0.32)
thumb.Size = UDim2.fromScale(0.18, 0.22)
thumb.BackgroundTransparency = 1

local img = Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
thumb.Image = img

--// FPS + PING
local statsLabel = Instance.new("TextLabel", main)
statsLabel.Position = UDim2.fromScale(0.27, 0.32)
statsLabel.Size = UDim2.fromScale(0.68, 0.22)
statsLabel.BackgroundTransparency = 1
statsLabel.TextColor3 = Color3.new(1,1,1)
statsLabel.TextScaled = true

local frames = 0
local last = tick()
RunService.RenderStepped:Connect(function()
	frames += 1
	if tick() - last >= 1 then
		local ping = math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue())
		statsLabel.Text = "FPS: "..frames.." | Ping: "..ping.." ms"
		frames = 0
		last = tick()
	end
end)

--// ESP BUTTON
local espBtn = Instance.new("TextButton", main)
espBtn.Position = UDim2.fromScale(0.05, 0.6)
espBtn.Size = UDim2.fromScale(0.9, 0.12)
espBtn.Text = "ESP [Murderer / Sheriff / All]"
espBtn.BackgroundColor3 = Settings.Accent
espBtn.TextColor3 = Color3.new(1,1,1)
espBtn.TextScaled = true
espBtn.BorderSizePixel = 0
Instance.new("UICorner", espBtn)

--// ESP SYSTEM
local Highlights = {}

local function getRole(plr)
	for _,tool in ipairs(plr.Character:GetChildren()) do
		if tool:IsA("Tool") then
			if tool.Name == "Knife" then
				return "Knife"
			elseif tool.Name == "Gun" then
				return "Gun"
			end
		end
	end
	return "None"
end

local function updateESP(plr)
	if not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") then return end
	
	if not Highlights[plr] then
		local h = Instance.new("Highlight")
		h.FillTransparency = 0.5
		h.OutlineTransparency = 0
		h.Parent = plr.Character
		Highlights[plr] = h
	end
	
	local role = getRole(plr)
	if role == "Knife" then
		Highlights[plr].FillColor = Color3.fromRGB(255,0,0)
	elseif role == "Gun" then
		Highlights[plr].FillColor = Color3.fromRGB(0,120,255)
	else
		Highlights[plr].FillColor = Color3.fromRGB(0,255,0)
	end
end

RunService.Heartbeat:Connect(function()
	if not Settings.ESP then return end
	for _,plr in ipairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character then
			updateESP(plr)
		end
	end
end)

espBtn.MouseButton1Click:Connect(function()
	Settings.ESP = not Settings.ESP
	espBtn.Text = Settings.ESP and "ESP ENABLED" or "ESP DISABLED"
	if not Settings.ESP then
		for _,h in pairs(Highlights) do h:Destroy() end
		table.clear(Highlights)
	end
end)

--// TOGGLE HUB
toggleBtn.MouseButton1Click:Connect(function()
	main.Visible = not main.Visible
end)
