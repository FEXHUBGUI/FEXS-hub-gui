--// M.Hub YVH - FULL RELEASE

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- CONFIG
local CLICK_SOUND_ID = "rbxassetid://72208252449982"

local ROLE_COLORS = {
	Homer = Color3.fromRGB(255, 70, 70),
	Bart = Color3.fromRGB(70, 255, 70)
}

-- ROLE CHECK (CHANGE THIS IF NEEDED)
local function getRole(plr)
	if plr.Team then
		return plr.Team.Name
	end
	return nil
end

-- CLICK SOUND
local function click(parent)
	local s = Instance.new("Sound")
	s.SoundId = CLICK_SOUND_ID
	s.Volume = 1
	s.Parent = parent
	s:Play()
	game.Debris:AddItem(s, 2)
end

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "M.Hub YVH"
gui.ResetOnSpawn = false
gui.Parent = LP.PlayerGui

-- MAIN FRAME
local main = Instance.new("Frame", gui)
main.Size = UDim2.fromScale(0.45, 0.55)
main.Position = UDim2.fromScale(0.275, 0.2)
main.BackgroundColor3 = Color3.fromRGB(25,25,25)
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0,14)

-- TITLE
local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1,0,0,40)
title.Text = "M.Hub YVH"
title.TextColor3 = Color3.new(1,1,1)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.BackgroundTransparency = 1

-- TABS
local tabFrame = Instance.new("Frame", main)
tabFrame.Position = UDim2.fromOffset(10,50)
tabFrame.Size = UDim2.new(1,-20,0,40)
tabFrame.BackgroundTransparency = 1

local function makeTab(text, x)
	local b = Instance.new("TextButton", tabFrame)
	b.Text = text
	b.Size = UDim2.fromOffset(140,36)
	b.Position = UDim2.fromOffset(x,0)
	b.Font = Enum.Font.GothamBold
	b.TextSize = 14
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = Color3.fromRGB(40,40,40)
	Instance.new("UICorner", b)
	return b
end

local mainTab = makeTab("Main",0)
local settingsTab = makeTab("Settings",150)

-- PAGES
local pages = Instance.new("Folder", main)

local function makePage()
	local f = Instance.new("Frame", pages)
	f.Size = UDim2.new(1,-20,1,-110)
	f.Position = UDim2.fromOffset(10,100)
	f.BackgroundTransparency = 1
	f.Visible = false
	return f
end

local mainPage = makePage()
local settingsPage = makePage()
mainPage.Visible = true

local function switchPage(p)
	for _,v in pairs(pages:GetChildren()) do
		v.Visible = false
	end
	p.Visible = true
end

mainTab.MouseButton1Click:Connect(function()
	click(mainTab)
	switchPage(mainPage)
end)

settingsTab.MouseButton1Click:Connect(function()
	click(settingsTab)
	switchPage(settingsPage)
end)

-- BUTTON STATE SYSTEM
local function updateButton(btn, name, state)
	if state then
		btn.Text = name .. " [ON]"
		btn.BackgroundColor3 = Color3.fromRGB(60,200,60)
	else
		btn.Text = name .. " [OFF]"
		btn.BackgroundColor3 = Color3.fromRGB(200,60,60)
	end
end

-- ESP SYSTEM
local espEnabled = false
local espObjects = {}

local function clearESP(plr)
	if espObjects[plr] then
		for _,v in pairs(espObjects[plr]) do
			if v and v.Destroy then
				v:Destroy()
			end
		end
	end
	espObjects[plr] = nil
end

local function createESP(plr)
	if plr == LP then return end
	if not plr.Character then return end

	local role = getRole(plr)
	if role ~= "Homer" and role ~= "Bart" then
		clearESP(plr)
		return
	end

	clearESP(plr)
	espObjects[plr] = {}

	local color = ROLE_COLORS[role]
	local char = plr.Character

	-- Highlight
	local hl = Instance.new("Highlight", char)
	hl.FillColor = color
	hl.OutlineColor = color
	table.insert(espObjects[plr], hl)

	-- Name Tag
	local head = char:FindFirstChild("Head")
	if head then
		local bb = Instance.new("BillboardGui", head)
		bb.Size = UDim2.fromOffset(100,40)
		bb.StudsOffset = Vector3.new(0,2.5,0)
		bb.AlwaysOnTop = true

		local txt = Instance.new("TextLabel", bb)
		txt.Size = UDim2.fromScale(1,1)
		txt.BackgroundTransparency = 1
		txt.Text = role:upper()
		txt.Font = Enum.Font.GothamBold
		txt.TextSize = 16
		txt.TextColor3 = color

		table.insert(espObjects[plr], bb)
	end

	-- Skeleton ESP
	local function beam(a,b)
		local at0 = Instance.new("Attachment", a)
		local at1 = Instance.new("Attachment", b)
		local bm = Instance.new("Beam", a)
		bm.Attachment0 = at0
		bm.Attachment1 = at1
		bm.Width0 = 0.05
		bm.Width1 = 0.05
		bm.Color = ColorSequence.new(color)
		table.insert(espObjects[plr], at0)
		table.insert(espObjects[plr], at1)
		table.insert(espObjects[plr], bm)
	end

	if char:FindFirstChild("UpperTorso") then
		beam(char.UpperTorso, char.Head)
		beam(char.UpperTorso, char.LeftUpperArm)
		beam(char.UpperTorso, char.RightUpperArm)
		beam(char.UpperTorso, char.LeftUpperLeg)
		beam(char.UpperTorso, char.RightUpperLeg)
	end
end

RunService.RenderStepped:Connect(function()
	if not espEnabled then return end
	for _,plr in pairs(Players:GetPlayers()) do
		createESP(plr)
	end
end)

-- ESP BUTTON
local espBtn = Instance.new("TextButton", mainPage)
espBtn.Size = UDim2.fromOffset(260,50)
espBtn.Position = UDim2.fromOffset(20,20)
espBtn.Font = Enum.Font.GothamBold
espBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", espBtn)
updateButton(espBtn,"ESP [Homer & Bart]",false)

espBtn.MouseButton1Click:Connect(function()
	click(espBtn)
	espEnabled = not espEnabled
	updateButton(espBtn,"ESP [Homer & Bart]",espEnabled)

	if not espEnabled then
		for p in pairs(espObjects) do
			clearESP(p)
		end
	end
end)

-- WALLHOP
local wallhop = false
local canJump = true

local hopBtn = espBtn:Clone()
hopBtn.Position = UDim2.fromOffset(20,90)
hopBtn.Parent = mainPage
updateButton(hopBtn,"WallHop",false)

hopBtn.MouseButton1Click:Connect(function()
	click(hopBtn)
	wallhop = not wallhop
	updateButton(hopBtn,"WallHop",wallhop)
end)

UIS.JumpRequest:Connect(function()
	if wallhop and canJump then
		canJump = false
		local hum = LP.Character and LP.Character:FindFirstChildOfClass("Humanoid")
		if hum then
			hum:ChangeState(Enum.HumanoidStateType.Jumping)
			Camera.CFrame *= CFrame.Angles(0, math.rad(90), 0)
			task.wait(0.05)
			Camera.CFrame *= CFrame.Angles(0, math.rad(-90), 0)
		end
		task.delay(0.25,function()
			canJump = true
		end)
	end
end)

-- SETTINGS PAGE
local userInfo = Instance.new("TextLabel", settingsPage)
userInfo.Size = UDim2.new(1,0,0,80)
userInfo.Text = "User:\n"..LP.DisplayName.." ("..LP.Name..")"
userInfo.TextColor3 = Color3.new(1,1,1)
userInfo.Font = Enum.Font.Gotham
userInfo.BackgroundTransparency = 1
userInfo.TextWrapped = true

-- GUI COLOR CHANGER
local colors = {
	Purple = Color3.fromRGB(140,90,255),
	Green = Color3.fromRGB(60,200,120),
	Blue = Color3.fromRGB(80,140,255),
	Red = Color3.fromRGB(200,70,70),
	Dark = Color3.fromRGB(25,25,25)
}

local y = 90
for name,color in pairs(colors) do
	local b = Instance.new("TextButton", settingsPage)
	b.Size = UDim2.fromOffset(160,40)
	b.Position = UDim2.fromOffset(0,y)
	b.Text = name
	b.Font = Enum.Font.GothamBold
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = color
	Instance.new("UICorner", b)

	b.MouseButton1Click:Connect(function()
		click(b)
		main.BackgroundColor3 = color
	end)

	y += 50
end

-- GUI LOCK
local locked = false
local lockBtn = Instance.new("TextButton", settingsPage)
lockBtn.Size = UDim2.fromOffset(160,40)
lockBtn.Position = UDim2.fromOffset(200,90)
lockBtn.Font = Enum.Font.GothamBold
lockBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", lockBtn)
updateButton(lockBtn,"Lock GUI",false)

lockBtn.MouseButton1Click:Connect(function()
	click(lockBtn)
	locked = not locked
	main.Draggable = not locked
	updateButton(lockBtn,"Lock GUI",locked)
end)

-- SIDE TOGGLE BUTTON
local sideToggle = Instance.new("TextButton", gui)
sideToggle.Size = UDim2.fromOffset(40,120)
sideToggle.Position = UDim2.fromScale(0,0.4)
sideToggle.Text = "â‰¡"
sideToggle.TextSize = 28
sideToggle.Font = Enum.Font.GothamBold
sideToggle.TextColor3 = Color3.new(1,1,1)
sideToggle.BackgroundColor3 = Color3.fromRGB(30,30,30)
sideToggle.Active = true
sideToggle.Draggable = true
Instance.new("UICorner", sideToggle).CornerRadius = UDim.new(1,0)

sideToggle.MouseButton1Click:Connect(function()
	click(sideToggle)
	main.Visible = not main.Visible
end)
