-- FEXS Hub Script
-- Place this LocalScript inside a ScreenGui

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Create GUI Elements
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FEXSHub"
ScreenGui.Parent = game.CoreGui -- use CoreGui for LocalScripts in modern Roblox

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 350)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local Title = Instance.new("TextLabel")
Title.Text = "FEXS Hub"
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 24
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Parent = MainFrame

-- Open/Close Button
local ToggleButton = Instance.new("TextButton")
ToggleButton.Text = "Close"
ToggleButton.Font = Enum.Font.SourceSansBold
ToggleButton.TextSize = 18
ToggleButton.Size = UDim2.new(0, 70, 0, 30)
ToggleButton.Position = UDim2.new(1, -75, 0, 5)
ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
ToggleButton.Parent = MainFrame

-- Helper function for buttons
local function createButton(text, positionY)
    local btn = Instance.new("TextButton")
    btn.Text = text
    btn.Font = Enum.Font.SourceSans
    btn.TextSize = 18
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.Position = UDim2.new(0, 10, 0, positionY)
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Parent = MainFrame
    return btn
end

local BoxESPButton = createButton("Toggle Box ESP", 50)
local ChamsButton = createButton("Toggle Chams", 95)

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Text = "Speed:"
SpeedLabel.Font = Enum.Font.SourceSans
SpeedLabel.TextSize = 18
SpeedLabel.TextColor3 = Color3.fromRGB(255,255,255)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Position = UDim2.new(0, 10, 0, 140)
SpeedLabel.Size = UDim2.new(0, 60, 0, 30)
SpeedLabel.Parent = MainFrame

local SpeedDropdown = Instance.new("TextButton")
SpeedDropdown.Text = "Normal"
SpeedDropdown.Font = Enum.Font.SourceSans
SpeedDropdown.TextSize = 18
SpeedDropdown.Size = UDim2.new(0, 120, 0, 30)
SpeedDropdown.Position = UDim2.new(0, 70, 0, 140)
SpeedDropdown.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
SpeedDropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedDropdown.Parent = MainFrame

local SpeedOptions = {"Normal", "Fast", "Very Fast"}
local SpeedIndex = 1

local InfiniteJumpButton = createButton("Toggle Infinite Jump", 185)

-- State variables
local boxESPEnabled = false
local chamsEnabled = false
local infiniteJumpEnabled = false

-- For ESP Boxes
local espBoxes = {}

-- Speed values
local speeds = {
    Normal = 16,
    Fast = 50,
    ["Very Fast"] = 100
}

-- Toggle GUI visibility
ToggleButton.MouseButton1Click:Connect(function()
    if MainFrame.Visible then
        MainFrame.Visible = false
        ToggleButton.Text = "Open"
    else
        MainFrame.Visible = true
        ToggleButton.Text = "Close"
    end
end)

-- Box ESP Logic
local function createBox(player)
    local box = Drawing.new("Square")
    box.Visible = false
    box.Color = Color3.new(1, 0, 0) -- Red box
    box.Thickness = 2
    box.Transparency = 1
    box.Filled = false
    espBoxes[player] = box
end

local function updateBoxESP()
    for player, box in pairs(espBoxes) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
            local rootPart = player.Character.HumanoidRootPart
            local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(rootPart.Position)
            if onScreen and boxESPEnabled then
                box.Position = Vector2.new(screenPos.X - 25, screenPos.Y - 50)
                box.Size = Vector2.new(50, 100)
                box.Visible = true
            else
                box.Visible = false
            end
        else
            box.Visible = false
        end
    end
end

BoxESPButton.MouseButton1Click:Connect(function()
    boxESPEnabled = not boxESPEnabled
    if boxESPEnabled then
        BoxESPButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
        -- Create boxes for all players except LocalPlayer
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and not espBoxes[player] then
                createBox(player)
            end
        end
    else
        BoxESPButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        -- Hide all boxes
        for _, box in pairs(espBoxes) do
            box.Visible = false
        end
    end
end)

-- Update espBoxes when players join/leave
Players.PlayerAdded:Connect(function(player)
    if boxESPEnabled and player ~= LocalPlayer then
        createBox(player)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if espBoxes[player] then
        espBoxes[player]:Remove()
        espBoxes[player] = nil
    end
end)

-- Chams Logic (simple: highlights parts)
local chamHighlights = {}

local function createCham(player)
    if player.Character then
        for _, part in pairs(player.Character:GetChildren()) do
            if part:IsA("BasePart") then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = Color3.fromRGB(0, 255, 255)
                highlight.OutlineColor = Color3.fromRGB(0, 255, 255)
                highlight.Adornee = part
                highlight.Parent = part
                chamHighlights[part] = highlight
            end
        end
    end
end

local function removeChams()
    for _, highlight in pairs(chamHighlights) do
        if highlight and highlight.Parent then
            highlight:Destroy()
        end
    end
    chamHighlights = {}
end

ChamsButton.MouseButton1Click:Connect(function()
    chamsEnabled = not chamsEnabled
    if chamsEnabled then
        ChamsButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                createCham(player)
            end
        end
    else
        ChamsButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        removeChams()
    end
end)

Players.PlayerAdded:Connect(function(player)
    if chamsEnabled and player ~= LocalPlayer then
        player.CharacterAdded:Connect(function()
            wait(1)
            createCham(player)
        end)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if chamsEnabled then
        for part, highlight in pairs(chamHighlights) do
            if part.Parent and part.Parent.Parent == player.Character then
                highlight:Destroy()
                chamHighlights[part] = nil
            end
        end
    end
end)

-- Speed changer logic
local function setSpeed(speedName)
    local char = LocalPlayer.Character
    if char and char:FindFirstChildOfClass("Humanoid") then
        char:FindFirstChildOfClass("Humanoid").WalkSpeed = speeds[speedName] or 16
        SpeedDropdown.Text = speedName
    end
end

SpeedDropdown.MouseButton1Click:Connect(function()
    SpeedIndex = SpeedIndex + 1
    if SpeedIndex > #SpeedOptions then SpeedIndex = 1 end
    setSpeed(SpeedOptions[SpeedIndex])
end)

-- Infinite jump logic
UserInputService.JumpRequest:Connect(function()
    if infiniteJumpEnabled then
        LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

InfiniteJumpButton.MouseButton1Click:Connect(function()
    infiniteJumpEnabled = not infiniteJumpEnabled
    if infiniteJumpEnabled then
        InfiniteJumpButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
    else
        InfiniteJumpButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end
end)

-- Update loop for Box ESP
RunService.RenderStepped:Connect(function()
    if boxESPEnabled then
        updateBoxESP()
    end
end)

-- Initialize default speed
setSpeed("Normal")

return ScreenGui
