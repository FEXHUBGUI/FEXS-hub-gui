-- // Universal Hub GUI
-- Drop this in StarterGui > LocalScript
-- No HttpGet required, everything is self-contained

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local UIS = game:GetService("UserInputService")

local Player = Players.LocalPlayer

-- // Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UniversalHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

-- // Simple UI system
local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 400, 0, 300)
Frame.Position = UDim2.new(0.5, -200, 0.5, -150)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
Title.Text = "Universal Hub"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextScaled = true
Title.Parent = Frame

local TabButtons = Instance.new("Frame")
TabButtons.Size = UDim2.new(0, 100, 1, -30)
TabButtons.Position = UDim2.new(0, 0, 0, 30)
TabButtons.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
TabButtons.Parent = Frame

local Content = Instance.new("Frame")
Content.Size = UDim2.new(1, -100, 1, -30)
Content.Position = UDim2.new(0, 100, 0, 30)
Content.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Content.Parent = Frame

-- // Helper: Tab system
local Tabs = {}
local function CreateTab(name)
    local Btn = Instance.new("TextButton")
    Btn.Size = UDim2.new(1, 0, 0, 30)
    Btn.Text = name
    Btn.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
    Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    Btn.Parent = TabButtons

    local Page = Instance.new("ScrollingFrame")
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.CanvasSize = UDim2.new(0, 0, 0, 600)
    Page.BackgroundTransparency = 1
    Page.Visible = false
    Page.Parent = Content

    Btn.MouseButton1Click:Connect(function()
        for _,t in pairs(Tabs) do
            t.Page.Visible = false
        end
        Page.Visible = true
    end)

    local Tab = {Button = Btn, Page = Page}
    table.insert(Tabs, Tab)
    if #Tabs == 1 then
        Page.Visible = true
    end
    return Page
end

local function AddButton(tab, text, callback)
    local Btn = Instance.new("TextButton")
    Btn.Size = UDim2.new(1, -10, 0, 40)
    Btn.Position = UDim2.new(0, 5, 0, #tab:GetChildren() * 45)
    Btn.Text = text
    Btn.BackgroundColor3 = Color3.fromRGB(75, 75, 75)
    Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    Btn.Parent = tab
    Btn.MouseButton1Click:Connect(callback)
end

-- // Tabs
local MainTab = CreateTab("Main")
local PlayerTab = CreateTab("Player")
local VisualsTab = CreateTab("Visuals")

-- // Features
AddButton(MainTab, "Rejoin", function()
    TeleportService:Teleport(game.PlaceId, Player)
end)

AddButton(MainTab, "Server Hop", function()
    local servers = HttpService:JSONDecode(game:HttpGet(
        "https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"
    ))
    for _,s in pairs(servers.data) do
        if s.playing < s.maxPlayers then
            TeleportService:TeleportToPlaceInstance(game.PlaceId, s.id, Player)
            break
        end
    end
end)

AddButton(PlayerTab, "Toggle Noclip", function()
    if _G.NoclipLoop then
        _G.NoclipLoop:Disconnect()
        _G.NoclipLoop = nil
    else
        _G.NoclipLoop = RunService.Stepped:Connect(function()
            if Player.Character then
                for _,v in pairs(Player.Character:GetDescendants()) do
                    if v:IsA("BasePart") then
                        v.CanCollide = false
                    end
                end
            end
        end)
    end
end)

AddButton(PlayerTab, "Fly (toggle)", function()
    _G.Flying = not _G.Flying
    local char = Player.Character or Player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    local hum = char:WaitForChild("Humanoid")

    if _G.Flying then
        local bg = Instance.new("BodyGyro", hrp)
        local bv = Instance.new("BodyVelocity", hrp)
        bg.P = 9e4 bg.MaxTorque = Vector3.new(9e9,9e9,9e9)
        bv.MaxForce = Vector3.new(9e9,9e9,9e9)

        RunService.RenderStepped:Connect(function()
            if not _G.Flying then
                bg:Destroy() bv:Destroy()
                return
            end
            local move = hum.MoveDirection
            bv.Velocity = Vector3.new(move.X*50, (UIS:IsKeyDown(Enum.KeyCode.Space) and 50) or (UIS:IsKeyDown(Enum.KeyCode.LeftControl) and -50) or 0, move.Z*50)
        end)
    end
end)

AddButton(VisualsTab, "Toggle ESP", function()
    _G.ESPEnabled = not _G.ESPEnabled
    for _,plr in pairs(Players:GetPlayers()) do
        if plr ~= Player and plr.Character and plr.Character:FindFirstChild("Head") then
            if _G.ESPEnabled then
                if not plr.Character.Head:FindFirstChild("ESP") then
                    local bb = Instance.new("BillboardGui", plr.Character.Head)
                    bb.Name = "ESP"
                    bb.Size = UDim2.new(0,200,0,50)
                    bb.AlwaysOnTop = true
                    bb.StudsOffset = Vector3.new(0,2,0)
                    local lbl = Instance.new("TextLabel", bb)
                    lbl.Size = UDim2.new(1,0,1,0)
                    lbl.BackgroundTransparency = 1
                    lbl.Text = plr.Name
                    lbl.TextColor3 = Color3.new(1,0,0)
                    lbl.TextScaled = true
                end
            else
                if plr.Character.Head:FindFirstChild("ESP") then
                    plr.Character.Head.ESP:Destroy()
                end
            end
        end
    end
end)
